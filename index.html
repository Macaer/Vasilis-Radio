<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>MACAER RADIO</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Αριστερή στήλη -->
    <div class="left-column">
      <h1>
        <img src="logos/macaer_logo.png" alt="MACAER Logo" class="page-icon">
        MACAER RADIO
      </h1>
      <div id="current-info" class="current-info">
        <img id="current-logo" src="" alt="" class="current-logo" style="display:none;">
        <h2 id="current-name" style="display:none;"></h2>
        <p class="now-playing" id="current-now-playing" style="display:none;">
          Τώρα παίζει: <span id="current-track">—</span>
        </p>
        <img id="cover-art" src="" alt="Cover Art" class="cover-art" style="display:none;">
      </div>
    </div>

    <!-- Μεσαία στήλη -->
    <div class="middle-column">
      <ul id="category-list">
        <li data-category="FM Stations">FM Stations</li>
        <li data-category="ERT Echo">ERT Echo</li>
        <li data-category="House Music">House Music</li>
        <li data-category="Internet Radio">Internet Radio</li>
      </ul>
    </div>

    <!-- Δεξιά στήλη -->
    <div class="right-column">
      <select id="station-select">
        <option value="">— Επιλέξτε σταθμό —</option>
      </select>
    </div>
  </div>

  <script src="stations.js"></script>
  <script>
    const stationSelect = document.getElementById("station-select");
    const categoryList = document.getElementById("category-list");

    let currentAudio = null;
    let metadataInterval = null;

    categoryList.addEventListener("click", (e) => {
      if (e.target.tagName === "LI") {
        const category = e.target.dataset.category;
        stationSelect.innerHTML = '<option value="">— Επιλέξτε σταθμό —</option>';
        stations
          .filter(s => s.category === category)
          .forEach((station, index) => {
            const option = document.createElement("option");
            option.value = index;
            option.textContent = station.name;
            stationSelect.appendChild(option);
          });
      }
    });

    stationSelect.addEventListener("change", () => {
      const index = stationSelect.value;
      if (index === "") return;
      const station = stations[index];

      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      if (metadataInterval) {
        clearInterval(metadataInterval);
        metadataInterval = null;
      }

      currentAudio = new Audio(station.stream);
      currentAudio.play();

      document.getElementById("current-logo").src = station.logo;
      document.getElementById("current-logo").alt = station.name;
      document.getElementById("current-logo").style.display = "inline";

      document.getElementById("current-name").textContent = station.name;
      document.getElementById("current-name").style.display = "block";

      document.getElementById("current-now-playing").style.display = "block";
      document.getElementById("current-track").textContent = "—";
      document.getElementById("cover-art").style.display = "none";

      if (station.metadataUrl) {
        const updateMetadata = () => {
          fetch(station.metadataUrl)
            .then(res => res.json())
            .then(data => {
              const source = Array.isArray(data.icestats.source)
                ? data.icestats.source[0]
                : data.icestats.source;
              const meta = source?.title || source?.artist || source?.streamtitle || "—";
              document.getElementById("current-track").textContent = meta;

              fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(meta)}&entity=song&limit=1`)
                .then(res => res.json())
                .then(result => {
                  const artwork = result.results?.[0]?.artworkUrl100?.replace("100x100", "300x300");
                  if (artwork) {
                    const cover = document.getElementById("cover-art");
                    cover.src = artwork;
                    cover.style.display = "block";
                  }
                });
            })
            .catch(() => {
              document.getElementById("current-track").textContent = "—";
            });
        };
        updateMetadata();
        metadataInterval = setInterval(updateMetadata, 15000);
      }
    });
  </script>
</body>
</html>